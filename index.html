<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>BinCun Photo - Capture Memories | Photobooth Online</title>
    
    <!-- External CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/camera.css">
    <link rel="stylesheet" href="css/filters.css">
    <link rel="stylesheet" href="css/camera-selector.css">
    <link rel="stylesheet" href="css/frames.css">
    <link rel="stylesheet" href="css/responsive.css">
</head>
<body class="p-4" data-layout="1x4">
    <!-- Header -->
    <div class="text-center mb-6">
        <h1 class="logo-text mb-2">
            <i class="fas fa-camera-retro"></i> BinCun Photo <i class="fas fa-sparkles"></i>
        </h1>
        <p class="subtitle">
            <i class="fas fa-heart"></i> Capture Memories <i class="fas fa-heart"></i>
        </p>
    </div>

    <div class="max-w-7xl mx-auto">
        <div class="grid grid-cols-1 md:grid-cols-12 gap-6">
            <!-- Left Panel - Settings -->
            <div class="space-y-4 md:col-span-3">
                <!-- Layout -->
                <div class="settings-card">
                    <h3 class="settings-title">
                        <i class="fas fa-grid-2"></i> Layout Ảnh
                    </h3>
                    <div class="flex flex-wrap gap-2">
                        <button class="layout-option active" data-layout="1x4" data-max="4">
                            <i class="fas fa-grip-lines"></i> 1×4
                        </button>
                        <button class="layout-option" data-layout="2x2" data-max="4">
                            <i class="fas fa-th"></i> 2×2
                        </button>
                        <button class="layout-option" data-layout="2x3" data-max="6">
                            <i class="fas fa-th-large"></i> 2×3
                        </button>
                    </div>
                </div>

                <!-- Countdown Timer -->
                <div class="settings-card">
                    <h3 class="settings-title">
                        <i class="fas fa-clock"></i> Đếm Ngược
                    </h3>
                    <div class="timer-grid">
                        <button class="timer-btn" data-timer="0">
                            <i class="fas fa-bolt"></i>
                            <span>Không</span>
                        </button>
                        <button class="timer-btn active" data-timer="3">
                            <i class="fas fa-hourglass-start"></i>
                            <span>3s</span>
                        </button>
                        <button class="timer-btn" data-timer="5">
                            <i class="fas fa-hourglass-half"></i>
                            <span>5s</span>
                        </button>
                        <button class="timer-btn" data-timer="10">
                            <i class="fas fa-hourglass"></i>
                            <span>10s</span>
                        </button>
                        <button class="timer-btn" data-timer="15">
                            <i class="fas fa-hourglass-end"></i>
                            <span>15s</span>
                        </button>
                        <button class="timer-btn timer-btn-custom" id="customTimerBtn">
                            <i class="fas fa-sliders"></i>
                            <span>Tùy chọn</span>
                        </button>
                    </div>
                    
                    <!-- Custom timer input (hidden by default) -->
                    <div id="customTimerInput" class="custom-timer-input hidden">
                        <div class="flex items-center gap-2 mt-3">
                            <input 
                                type="number" 
                                id="customTimerValue" 
                                min="1" 
                                max="60" 
                                value="3" 
                                class="custom-timer-number"
                                placeholder="Nhập giây"
                            />
                            <span class="text-gray-600">giây</span>
                            <button id="applyCustomTimer" class="btn-apply-custom">
                                <i class="fas fa-check"></i> OK
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Filters -->
                <div class="settings-card">
                    <h3 class="settings-title">
                        <i class="fas fa-palette"></i> Bộ Lọc
                    </h3>
                    <div class="modern-filter-grid">
                        <button class="modern-filter-btn active" data-filter="none">
                            <div class="filter-preview" style="background: linear-gradient(135deg, #fff, #f0f0f0);"></div>
                            <span>Gốc</span>
                        </button>
                        <button class="modern-filter-btn" data-filter="grayscale">
                            <div class="filter-preview" style="background: linear-gradient(135deg, #666, #999);"></div>
                            <span>B&W</span>
                        </button>
                        <button class="modern-filter-btn" data-filter="sepia">
                            <div class="filter-preview" style="background: linear-gradient(135deg, #8B7355, #D2B48C);"></div>
                            <span>Sepia</span>
                        </button>
                        <button class="modern-filter-btn" data-filter="warm">
                            <div class="filter-preview" style="background: linear-gradient(135deg, #FF8C00, #FFD700);"></div>
                            <span>Ấm</span>
                        </button>
                        <button class="modern-filter-btn" data-filter="cool">
                            <div class="filter-preview" style="background: linear-gradient(135deg, #4682B4, #87CEEB);"></div>
                            <span>Lạnh</span>
                        </button>
                        <button class="modern-filter-btn" data-filter="vintage">
                            <div class="filter-preview" style="background: linear-gradient(135deg, #8B4513, #CD853F);"></div>
                            <span>Vintage</span>
                        </button>
                    </div>
                </div>

                <!-- Camera Selection -->
                <div id="cameraSelectionSection" class="settings-card">
                    <h3 class="settings-title">
                        <i class="fas fa-video"></i> Camera
                    </h3>
                    <select id="cameraSelect" class="camera-select">
                        <option value="">Đang tải danh sách...</option>
                    </select>
                    <button id="refreshCameraBtn" class="refresh-camera-btn">
                        <i class="fas fa-rotate"></i> Làm mới
                    </button>
                </div>
            </div>

            <!-- Center Panel - Camera -->
            <div class="space-y-4 md:col-span-6">
                <div class="bg-white rounded-2xl p-4 shadow-lg">
                    <div class="relative">
                        <video id="video" autoplay playsinline></video>
                        <canvas id="canvas"></canvas>
                        <button id="flipCameraBtn" class="flip-camera-btn hidden" title="Lật camera">
                            <i class="fas fa-camera-rotate"></i>
                        </button>
                        <div id="countdown" class="countdown-overlay hidden">
                            <div class="countdown-number" id="countdownNumber">3</div>
                        </div>
                    </div>
                    
                    <!-- Camera Controls -->
                    <div class="camera-controls">
                        <button id="startCameraBtn" class="btn-pink">
                            <i class="fas fa-video mr-2"></i>Bật Camera
                        </button>
                        <button id="autoCaptureBtn" class="btn-auto-capture hidden" title="Tự động chụp">
                            <i class="fas fa-bolt"></i>
                        </button>
                        <button id="captureBtn" class="btn-capture hidden" title="Chụp ảnh"></button>
                        <button id="resetBtn" class="btn-pink hidden">
                            <i class="fas fa-redo mr-2"></i>Chụp Lại
                        </button>
                    </div>

                    <!-- Options -->
                    <div class="mt-4 flex items-center justify-center gap-4">
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" id="videoRecap" class="mr-2">
                            <span class="text-sm text-gray-600">Video Recap</span>
                        </label>
                    </div>
                </div>

                <!-- Download Button -->
                <button id="downloadBtn" class="btn-pink w-full hidden">
                    <i class="fas fa-download mr-2"></i>Tải Ảnh
                </button>
                
                <!-- Change Frame Button -->
                <button class="btn-change-frame hidden" id="changeFrameBtn">
                    <i class="fas fa-images"></i> Chọn Khung Ảnh
                </button>
            </div>

            <!-- Right Panel - Photo Slots -->
            <div class="space-y-4 md:col-span-3">
                <div class="settings-card">
                    <h3 class="settings-title">
                        <i class="fas fa-images"></i> Ảnh Chụp <span id="photoCount" class="photo-count-badge">0/4</span>
                    </h3>
                    <div id="photoSlots" class="layout-1x4">
                        <div class="photo-slot" data-slot="0">
                            <i class="fas fa-image text-pink-300 text-4xl"></i>
                            <button class="delete-btn" onclick="deletePhoto(0)">
                                <i class="fas fa-times"></i>
                            </button>
                            <button class="swap-btn" onclick="openSwapModal(0)">
                                <i class="fas fa-arrows-rotate"></i>
                            </button>
                            <button class="upload-btn" onclick="uploadPhoto(0)">
                                <i class="fas fa-upload"></i>
                            </button>
                        </div>
                        <div class="photo-slot" data-slot="1">
                            <i class="fas fa-image text-pink-300 text-4xl"></i>
                            <button class="delete-btn" onclick="deletePhoto(1)">
                                <i class="fas fa-times"></i>
                            </button>
                            <button class="swap-btn" onclick="openSwapModal(1)">
                                <i class="fas fa-arrows-rotate"></i>
                            </button>
                            <button class="upload-btn" onclick="uploadPhoto(1)">
                                <i class="fas fa-upload"></i>
                            </button>
                        </div>
                        <div class="photo-slot" data-slot="2">
                            <i class="fas fa-image text-pink-300 text-4xl"></i>
                            <button class="delete-btn" onclick="deletePhoto(2)">
                                <i class="fas fa-times"></i>
                            </button>
                            <button class="swap-btn" onclick="openSwapModal(2)">
                                <i class="fas fa-arrows-rotate"></i>
                            </button>
                            <button class="upload-btn" onclick="uploadPhoto(2)">
                                <i class="fas fa-upload"></i>
                            </button>
                        </div>
                        <div class="photo-slot" data-slot="3">
                            <i class="fas fa-image text-pink-300 text-4xl"></i>
                            <button class="delete-btn" onclick="deletePhoto(3)">
                                <i class="fas fa-times"></i>
                            </button>
                            <button class="swap-btn" onclick="openSwapModal(3)">
                                <i class="fas fa-arrows-rotate"></i>
                            </button>
                            <button class="upload-btn" onclick="uploadPhoto(3)">
                                <i class="fas fa-upload"></i>
                            </button>
                        </div>
                        <div class="photo-slot hidden" data-slot="4">
                            <i class="fas fa-image text-pink-300 text-4xl"></i>
                            <button class="delete-btn" onclick="deletePhoto(4)">
                                <i class="fas fa-times"></i>
                            </button>
                            <button class="swap-btn" onclick="openSwapModal(4)">
                                <i class="fas fa-arrows-rotate"></i>
                            </button>
                            <button class="upload-btn" onclick="uploadPhoto(4)">
                                <i class="fas fa-upload"></i>
                            </button>
                        </div>
                        <div class="photo-slot hidden" data-slot="5">
                            <i class="fas fa-image text-pink-300 text-4xl"></i>
                            <button class="delete-btn" onclick="deletePhoto(5)">
                                <i class="fas fa-times"></i>
                            </button>
                            <button class="swap-btn" onclick="openSwapModal(5)">
                                <i class="fas fa-arrows-rotate"></i>
                            </button>
                            <button class="upload-btn" onclick="uploadPhoto(5)">
                                <i class="fas fa-upload"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Swap Modal -->
    <div id="swapModal" class="swap-modal">
        <div class="swap-modal-content">
            <h3>Chọn vị trí để hoán đổi</h3>
            <div class="swap-options" id="swapOptions">
                <!-- Options will be generated dynamically -->
            </div>
            <button class="btn-pink w-full" onclick="closeSwapModal()">Hủy</button>
        </div>
    </div>

    <!-- Hidden file input for photo upload -->
    <input type="file" id="photoUploadInput" accept="image/*" style="display: none;">

    <!-- Frame Selector Modal -->
    <div id="frameModal" class="frame-modal">
        <div class="frame-modal-content">
            <h3>
                <i class="fas fa-images"></i> Chọn Khung Ảnh <i class="fas fa-sparkles"></i>
            </h3>
            
            <div class="frame-selector-layout">
                <!-- Left Column: Preview (Sticky) -->
                <div class="frame-preview-column">
                    <h4 style="font-size: 16px; color: #666; margin-bottom: 10px; text-align: center;">
                        <i class="fas fa-eye"></i> Preview
                    </h4>
                    <div id="framePreview" class="frame-preview-container">
                        <!-- Preview will be generated here -->
                    </div>
                    
                    <div class="frame-preview-actions">
                        <button class="frame-modal-download-btn" id="downloadInModalBtn">
                            <i class="fas fa-download"></i> Tải Ảnh
                        </button>
                        <button class="frame-modal-close-btn" id="closeFrameBtn">
                            <i class="fas fa-check"></i> Xong
                        </button>
                    </div>
                </div>
                
                <!-- Right Column: Frame Options (Scrollable) -->
                <div class="frame-options-column">
                    <h4 style="font-size: 16px; color: #666; margin-bottom: 10px; text-align: center;">
                        <i class="fas fa-images"></i> Danh Sách Khung Ảnh
                    </h4>
                    <div class="frame-options" id="frameOptions">
                        <!-- Frame options will be generated dynamically -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript Modules -->
    <script type="module" src="js/app.js"></script>
    <script src="js/debug.js"></script>
</body>
</html>
