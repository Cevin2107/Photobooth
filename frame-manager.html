<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Frame Manager</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 30px; }
        .container { max-width: 1200px; margin: 0 auto; background: white; border-radius: 20px; padding: 40px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); }
        h1 { color: #667eea; margin-bottom: 30px; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 25px; border-radius: 16px; }
        .stat-card h3 { font-size: 14px; opacity: 0.9; margin-bottom: 10px; }
        .stat-card .value { font-size: 36px; font-weight: 700; }
        .section { background: #f8f9fa; border-radius: 16px; padding: 30px; margin-bottom: 30px; }
        .section h2 { color: #667eea; margin-bottom: 20px; }
        textarea { width: 100%; min-height: 200px; padding: 15px; border: 2px solid #e2e8f0; border-radius: 12px; font-family: 'Courier New'; font-size: 13px; }
        button { padding: 12px 24px; border: none; border-radius: 12px; font-weight: 600; cursor: pointer; color: white; margin-right: 10px; }
        .btn-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .btn-success { background: linear-gradient(135deg, #48bb78 0%, #38a169 100%); }
        .btn-warning { background: linear-gradient(135deg, #f6ad55 0%, #ed8936 100%); }
        .alert { padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .alert-success { background: #d1fae5; color: #065f46; }
        .alert-error { background: #fee2e2; color: #991b1b; }
        .alert-warning { background: #fef3c7; color: #92400e; }
        .result-box { background: #1e1e1e; color: #d4d4d4; padding: 20px; border-radius: 12px; font-family: 'Courier New'; font-size: 13px; max-height: 400px; overflow-y: auto; white-space: pre-wrap; margin-top: 20px; }
        .frames-preview { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px; margin-top: 20px; }
        .frame-item { background: white; border: 2px solid #e2e8f0; border-radius: 12px; padding: 10px; text-align: center; transition: all 0.3s; }
        .frame-item:hover { border-color: #667eea; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2); }
        .frame-item img { width: 100%; height: 200px; object-fit: contain; border-radius: 8px; background: #f8f9fa; }
        .frame-item .name { font-size: 12px; margin-top: 8px; color: #666; font-weight: 600; }
        .duplicate-badge { background: #fbbf24; color: #78350f; padding: 2px 8px; border-radius: 4px; font-size: 11px; font-weight: 600; margin-top: 5px; display: inline-block; }
        .new-badge { background: #10b981; color: white; padding: 2px 8px; border-radius: 4px; font-size: 11px; font-weight: 600; margin-top: 5px; display: inline-block; }
    </style>
</head>
<body>
    <div class="container">
        <h1><i class="fas fa-search"></i> Frame Manager</h1>
        <div class="stats-grid">
            <div class="stat-card"><h3>Frames trong Code</h3><div class="value" id="codeFrames">-</div></div>
            <div class="stat-card"><h3>Frames mới</h3><div class="value" id="newFrames">-</div></div>
            <div class="stat-card"><h3>Trùng lặp</h3><div class="value" id="duplicateFrames">-</div></div>
            <div class="stat-card"><h3>Không trùng</h3><div class="value" id="uniqueFrames">-</div></div>
        </div>
        <div id="alertContainer"></div>
        <div class="section">
            <h2>Paste JSON từ Bookmarklet</h2>
            <textarea id="jsonInput" placeholder="Paste JSON từ Bookmarklet..."></textarea>
            <button class="btn-primary" onclick="checkDuplicates()"><i class="fas fa-search"></i> Check Duplicates</button>
            <button class="btn-warning" onclick="document.getElementById('jsonInput').value=''"><i class="fas fa-trash"></i> Clear</button>
            <button class="btn-success" onclick="window.open('bookmarklet.html')"><i class="fas fa-bookmark"></i> Bookmarklet</button>
        </div>
        <div class="section" id="resultSection" style="display:none;">
            <h2>✅ Code JSON không trùng (Copy vào default-frames.js)</h2>
            <div class="alert alert-success">Copy JSON bên dưới và paste vào js/default-frames.js</div>
            <div id="resultBox" class="result-box"></div>
            <button class="btn-success" onclick="copyResult()"><i class="fas fa-copy"></i> Copy JSON</button>
        </div>
        <div class="section" id="previewSection" style="display:none;">
            <h2>🖼️ Preview Frames (Trùng & Không trùng)</h2>
            <div id="framesPreview" class="frames-preview"></div>
        </div>
        <div class="section">
            <h2>Frames trong Code</h2>
            <button class="btn-primary" onclick="showCurrentFrames()"><i class="fas fa-eye"></i> Xem Frames</button>
            <div id="currentFramesBox" class="result-box" style="display:none;"></div>
            <div id="currentFramesPreview" class="frames-preview"></div>
        </div>
    </div>
    <script type="module">
        import { DEFAULT_FRAMES_JSON } from './js/default-frames.js';
        document.getElementById('codeFrames').textContent = DEFAULT_FRAMES_JSON.length;
        window.checkDuplicates = function() {
            const input = document.getElementById('jsonInput').value.trim();
            if (!input) { showAlert('Paste JSON vào ô input!', 'error'); return; }
            try {
                const newFrames = JSON.parse(input);
                if (!Array.isArray(newFrames)) throw new Error('JSON phải là array');
                if (newFrames.length === 0) throw new Error('Array rỗng');
                document.getElementById('newFrames').textContent = newFrames.length;
                const existingUrls = new Set(DEFAULT_FRAMES_JSON.map(f => f.url));
                const duplicates = newFrames.filter(frame => existingUrls.has(frame.url));
                const uniqueFrames = newFrames.filter(frame => !existingUrls.has(frame.url));
                document.getElementById('duplicateFrames').textContent = duplicates.length;
                document.getElementById('uniqueFrames').textContent = uniqueFrames.length;
                
                // Show preview with badges
                showFramesPreview(newFrames, existingUrls);
                document.getElementById('previewSection').style.display = 'block';
                
                if (uniqueFrames.length > 0) {
                    // Format without [ ] to paste directly into existing array
                    const jsonObjects = uniqueFrames.map(f => JSON.stringify(f, null, 2)).join(',\n');
                    document.getElementById('resultBox').textContent = jsonObjects;
                    document.getElementById('resultSection').style.display = 'block';
                    showAlert(`Có ${uniqueFrames.length} frames mới!`, 'success');
                } else {
                    document.getElementById('resultSection').style.display = 'none';
                    showAlert('Không có frames mới. Tất cả đã có trong code!', 'warning');
                }
            } catch (error) { showAlert('Lỗi: ' + error.message, 'error'); }
        };
        
        window.showFramesPreview = function(frames, existingUrls) {
            const container = document.getElementById('framesPreview');
            container.innerHTML = '';
            frames.forEach(frame => {
                const isDuplicate = existingUrls.has(frame.url);
                const item = document.createElement('div');
                item.className = 'frame-item';
                item.innerHTML = `
                    <img src="${frame.url}" alt="${frame.name}" loading="lazy">
                    <div class="name">${frame.name}</div>
                    ${isDuplicate ? '<span class="duplicate-badge">TRÙNG</span>' : '<span class="new-badge">MỚI</span>'}
                `;
                container.appendChild(item);
            });
        };
        window.showCurrentFrames = function() {
            const box = document.getElementById('currentFramesBox');
            box.textContent = `// Tổng: ${DEFAULT_FRAMES_JSON.length} frames\n\n` + JSON.stringify(DEFAULT_FRAMES_JSON, null, 2);
            box.style.display = 'block';
            
            // Show preview
            const container = document.getElementById('currentFramesPreview');
            container.innerHTML = '';
            DEFAULT_FRAMES_JSON.forEach(frame => {
                const item = document.createElement('div');
                item.className = 'frame-item';
                item.innerHTML = `
                    <img src="${frame.url}" alt="${frame.name}" loading="lazy">
                    <div class="name">${frame.name}</div>
                `;
                container.appendChild(item);
            });
        };
        window.copyResult = function() {
            navigator.clipboard.writeText(document.getElementById('resultBox').textContent)
                .then(() => showAlert('Đã copy! Paste vào default-frames.js', 'success'))
                .catch(() => showAlert('Copy thất bại!', 'error'));
        };
        function showAlert(message, type) {
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            document.getElementById('alertContainer').appendChild(alert);
            setTimeout(() => alert.remove(), 5000);
        }
        window.showAlert = showAlert;
    </script>
</body>
</html>
